<template>
    <div class="container"> 
	
			<div class="title-animated">
				
					<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
							class="animated" 
							 viewBox="0 130.5 960 235" enable-background="new 0 130.5 960 235" xml:space="preserve">
							<path fill="none" stroke="#363636" stroke-width="4" stroke-miterlimit="10" d="M153.031,305.003
								c-10.344,5.465-23.226,8.197-38.644,8.197c-19.908,0-35.847-6.407-47.817-19.224C54.6,281.16,48.615,264.344,48.615,243.525
								c0-22.379,6.733-40.464,20.2-54.257c13.467-13.791,30.544-20.688,51.232-20.688c13.271,0,24.265,1.92,32.984,5.758v17.468
								c-10.02-5.595-21.079-8.393-33.179-8.393c-16.069,0-29.097,5.367-39.083,16.102c-9.987,10.734-14.979,25.079-14.979,43.035
								c0,17.045,4.667,30.626,14.003,40.741c9.335,10.117,21.582,15.175,36.741,15.175c14.052,0,26.217-3.122,36.497-9.368V305.003z"/>
							<path fill="none" stroke="#363636" stroke-width="4" stroke-miterlimit="10" d="M237.929,313.2c-19.843,0-35.733-6.538-47.67-19.614
								c-11.938-13.076-17.907-30.088-17.907-51.037c0-22.508,6.083-40.464,18.249-53.867c12.165-13.401,28.722-20.103,49.67-20.103
								c19.322,0,34.887,6.506,46.694,19.517c11.808,13.012,17.712,30.024,17.712,51.037c0,22.834-6.05,40.888-18.151,54.159
								S258.227,313.2,237.929,313.2z M239.1,183.413c-14.703,0-26.641,5.303-35.813,15.906c-9.173,10.605-13.76,24.527-13.76,41.767
								c0,17.24,4.472,31.114,13.418,41.62c8.944,10.507,20.606,15.76,34.984,15.76c15.353,0,27.453-5.009,36.301-15.028
								c8.847-10.017,13.271-24.037,13.271-42.059c0-18.476-4.293-32.755-12.881-42.839C266.034,188.455,254.192,183.413,239.1,183.413z"/>
							<path fill="none" stroke="#363636" stroke-width="4" stroke-miterlimit="10" d="M445.004,310.859h-20.103l-72.018-111.54
								c-1.822-2.796-3.318-5.724-4.489-8.782h-0.585c0.52,2.993,0.781,9.401,0.781,19.224v101.098h-16.395V170.922h21.274l70.065,109.782
								c2.928,4.555,4.814,7.678,5.66,9.369h0.39c-0.651-4.033-0.976-10.896-0.976-20.591v-98.561h16.395V310.859z"/>
							<path fill="none" stroke="#363636" stroke-width="4" stroke-miterlimit="10" d="M564.448,185.755h-40.4v125.104h-16.394V185.755
								h-40.303v-14.833h97.097V185.755z"/>
							<path fill="none" stroke="#363636" stroke-width="4" stroke-miterlimit="10" d="M694.724,310.859h-18.15L661.74,271.63h-59.332
								l-13.954,39.229h-18.249l53.672-139.937h16.979L694.724,310.859z M656.373,256.894l-21.957-59.625
								c-0.717-1.952-1.432-5.074-2.146-9.368h-0.391c-0.651,3.969-1.399,7.092-2.244,9.368l-21.762,59.625H656.373z"/>
							<path fill="none" stroke="#363636" stroke-width="4" stroke-miterlimit="10" d="M810.558,305.003
								c-10.344,5.465-23.226,8.197-38.644,8.197c-19.907,0-35.848-6.407-47.816-19.224c-11.972-12.816-17.956-29.632-17.956-50.452
								c0-22.379,6.733-40.464,20.2-54.257c13.467-13.791,30.544-20.688,51.232-20.688c13.271,0,24.265,1.92,32.983,5.758v17.468
								c-10.02-5.595-21.078-8.393-33.179-8.393c-16.069,0-29.098,5.367-39.083,16.102c-9.987,10.734-14.979,25.079-14.979,43.035
								c0,17.045,4.668,30.626,14.004,40.741c9.334,10.117,21.581,15.175,36.74,15.175c14.053,0,26.217-3.122,36.497-9.368V305.003z"/>
							<path fill="none" stroke="#363636" stroke-width="4" stroke-miterlimit="10" d="M921.804,185.755h-40.4v125.104H865.01V185.755
								h-40.303v-14.833h97.097V185.755z"/>"/>
					</svg>
						
					<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
							class="is-hidden" 
							 viewBox="0 130.5 960 235" enable-background="new 0 130.5 960 235" xml:space="preserve">
							<path fill="#363636" stroke="none" stroke-width="4" stroke-miterlimit="10" d="M153.031,305.003
								c-10.344,5.465-23.226,8.197-38.644,8.197c-19.908,0-35.847-6.407-47.817-19.224C54.6,281.16,48.615,264.344,48.615,243.525
								c0-22.379,6.733-40.464,20.2-54.257c13.467-13.791,30.544-20.688,51.232-20.688c13.271,0,24.265,1.92,32.984,5.758v17.468
								c-10.02-5.595-21.079-8.393-33.179-8.393c-16.069,0-29.097,5.367-39.083,16.102c-9.987,10.734-14.979,25.079-14.979,43.035
								c0,17.045,4.667,30.626,14.003,40.741c9.335,10.117,21.582,15.175,36.741,15.175c14.052,0,26.217-3.122,36.497-9.368V305.003z"/>
							<path fill="#363636" stroke="none" stroke-width="4" stroke-miterlimit="10" d="M237.929,313.2c-19.843,0-35.733-6.538-47.67-19.614
								c-11.938-13.076-17.907-30.088-17.907-51.037c0-22.508,6.083-40.464,18.249-53.867c12.165-13.401,28.722-20.103,49.67-20.103
								c19.322,0,34.887,6.506,46.694,19.517c11.808,13.012,17.712,30.024,17.712,51.037c0,22.834-6.05,40.888-18.151,54.159
								S258.227,313.2,237.929,313.2z M239.1,183.413c-14.703,0-26.641,5.303-35.813,15.906c-9.173,10.605-13.76,24.527-13.76,41.767
								c0,17.24,4.472,31.114,13.418,41.62c8.944,10.507,20.606,15.76,34.984,15.76c15.353,0,27.453-5.009,36.301-15.028
								c8.847-10.017,13.271-24.037,13.271-42.059c0-18.476-4.293-32.755-12.881-42.839C266.034,188.455,254.192,183.413,239.1,183.413z"/>
							<path fill="#363636" stroke="none" stroke-width="4" stroke-miterlimit="10" d="M445.004,310.859h-20.103l-72.018-111.54
								c-1.822-2.796-3.318-5.724-4.489-8.782h-0.585c0.52,2.993,0.781,9.401,0.781,19.224v101.098h-16.395V170.922h21.274l70.065,109.782
								c2.928,4.555,4.814,7.678,5.66,9.369h0.39c-0.651-4.033-0.976-10.896-0.976-20.591v-98.561h16.395V310.859z"/>
							<path fill="#363636" stroke="none" stroke-width="4" stroke-miterlimit="10" d="M564.448,185.755h-40.4v125.104h-16.394V185.755
								h-40.303v-14.833h97.097V185.755z"/>
							<path fill="#363636" stroke="none" stroke-width="4" stroke-miterlimit="10" d="M694.724,310.859h-18.15L661.74,271.63h-59.332
								l-13.954,39.229h-18.249l53.672-139.937h16.979L694.724,310.859z M656.373,256.894l-21.957-59.625
								c-0.717-1.952-1.432-5.074-2.146-9.368h-0.391c-0.651,3.969-1.399,7.092-2.244,9.368l-21.762,59.625H656.373z"/>
							<path fill="#363636" stroke="none" stroke-width="4" stroke-miterlimit="10" d="M810.558,305.003
								c-10.344,5.465-23.226,8.197-38.644,8.197c-19.907,0-35.848-6.407-47.816-19.224c-11.972-12.816-17.956-29.632-17.956-50.452
								c0-22.379,6.733-40.464,20.2-54.257c13.467-13.791,30.544-20.688,51.232-20.688c13.271,0,24.265,1.92,32.983,5.758v17.468
								c-10.02-5.595-21.078-8.393-33.179-8.393c-16.069,0-29.098,5.367-39.083,16.102c-9.987,10.734-14.979,25.079-14.979,43.035
								c0,17.045,4.668,30.626,14.004,40.741c9.334,10.117,21.581,15.175,36.74,15.175c14.053,0,26.217-3.122,36.497-9.368V305.003z"/>
							<path fill="#363636" stroke="none" stroke-width="4" stroke-miterlimit="10" d="M921.804,185.755h-40.4v125.104H865.01V185.755
								h-40.303v-14.833h97.097V185.755z"/>"/>
					</svg>
  
			 </div>  
	
					 <div class="contact-form" v-html="contact"> 
					 </div>  
					 
					 <template></template> 
					 
    </div>
</template>

<script>
    import moment from 'moment';
	 
    import Form from '../../utilities/Form';// watch directory level
	  

    export default {
		 
		//components: {AddToStream}, 

		/*components: {
			ParticleEffectButton
		},	*/	
	
	//template: `<div>hello</div>`,
		data(){
			return { 
				contact: window.loadingHtml, 
				form: new Form({ message: '', name: '', email: '', _token:'' })  
			} 	
		}, 
		
        created() {
            console.log('contact Component created.');
			axios.get('/siteyoann/contact')
			//.then(response => this.contact = response.data);
			.then(({data}) => this.load(data)) 
			.then(() => {
						this.form._action = document.querySelector('#contactform').action;
						this.form._method = document.querySelector('#contactform').method;
						this.form._token = document.querySelector('[name=_token]').value;
								document.getElementById("contactform").addEventListener("submit", (event) => {
									//	console.log('submit event listener.'); 							 
										event.preventDefault(); 
										this.onSubmit();
								}); 
								document.getElementById("name").addEventListener("change", (event) => { 
										document.querySelector('button[type=submit]').classList.remove('is-loading') ;
										this.$data.form.name = document.getElementById("name").value;
								}); 
								document.getElementById("email").addEventListener("change", (event) => { 
										document.querySelector('button[type=submit]').classList.remove('is-loading') ;
										this.$data.form.email = document.getElementById("email").value;
								}); 
								document.getElementById("message").addEventListener("change", (event) => { 
										document.querySelector('button[type=submit]').classList.remove('is-loading') ;
										this.$data.form.message = document.getElementById("message").value;
								}); 
								 
					});	//HTML		
            ///console.log(this.contact );
            
        },		
		
        methods : {
                //addStatus(project) { 
               // } 		
				load(data){
					//console.log(this);
					this.contact = data; 
					//this.$data.form._token = document.querySelector('[name=_token]').value; 
				},
				onSubmit() {
					console.log('onSubmit !'); 
					console.log(this); 
					
					// document.querySelector('button[type=submit]').disabled = true;
					document.querySelector('button[type=submit]').classList.add('is-loading') ;
					 
					this.form.name 	  = this.$data.form.originalData.name = document.querySelector('#name').value;
					this.form.email   = this.$data.form.originalData.email = document.querySelector('#email').value;
					this.form.message = this.$data.form.originalData.message = document.querySelector('#message').value; 
					this.form._token  = this.$data.form.originalData._token = document.querySelector('[name=_token]').value; 
					 
					
					this.form.originalData = this.$data.form.originalData;
					//this.form.data();
					
					/*
					//this.$data.form.errors = {}   ; 
					*/
				//	this.form.data({ message: this.$data.form.message, name: this.$data.form.name, email: this.$data.form.email, _token:this.$data.form._token })
					
					
					//console.log(this);
						
						this.form
							.post(this.form._action)
							//.post('/contact-bulma')
							.then( response => {
										console.log('completed demand, response is', response);
										//alert(response.success);
										if(response.success == true) {
											
											console.log('success');	 
											this.$data.contact = '<div class=" has-text-centered">Sent<br/><span class="icon is-medium"><i class="fa fa-2x fa-check"></i></span></div>'
											
										} else if(response.success == false) {  
												let removeMsgs = 'while(this.parentNode.parentNode.lastChild){this.parentNode.parentNode.removeChild(this.parentNode.parentNode.lastChild);}';							
												let msgBox = document.createElement('div');														
												msgBox.classList.add('is-danger', 'notification') ;	 
												msgBox.innerHTML = `<a class="delete" onclick="${removeMsgs}"></a>`; 
												document.getElementById('messages').appendChild(msgBox);
												
												for (let field in response.errors) {
													this[field] = response.errors[field];//saving var
													let err = document.createElement('div'); 
														err.classList.add('is-danger', 'notification') ;
														err.innerHTML = `${this[field]}`;  //error message  
														msgBox.appendChild(err); 
													
												}  
										} else {
											console.log('unknown error');	
										}
								});
							//.then( status => this.$emit('completed', status)); 
				}
				 
        },
		
        mounted() {
            console.log('contact mounted.');
			return typeof(window.animSvg) !== 'function' ? false : window.animSvg() ;
			 
        } 
    }
//console.log('runs first') // this    runs only once before the export!
</script>
